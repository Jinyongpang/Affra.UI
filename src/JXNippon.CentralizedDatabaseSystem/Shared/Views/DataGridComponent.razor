@using System.Linq.Dynamic.Core
@using System.Dynamic
@using System.ComponentModel
@using AntDesign.TableModels
@using JXNippon.CentralizedDatabaseSystem.Domain.Interfaces
@using JXNippon.CentralizedDatabaseSystem.Domain.Views
@using JXNippon.CentralizedDatabaseSystem.Models

<RadzenDataGrid @ref="grid" IsLoading="@isLoading" Count="@this.Count" Data="@this.itemsDictionary" LoadData="@this.LoadDataAsync" 
    FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive" AllowSorting="true" AllowFiltering="false" AllowPaging="true" 
    PageSize=5 PageSizeText="Items" PageSizeOptions=@this.pageSizeOptions PagerHorizontalAlign="HorizontalAlign.Center" AllowColumnResize="true" ShowPagingSummary="true" 
    AllowMultiColumnSorting="false" ShowMultiColumnSortingIndex="false"
    PagerAlwaysVisible="false">
    <Columns>
        @foreach(var gridColumn in GridColumns)
        {
            var isSortable = gridColumn.Property == "Date"
                || gridColumn.Property == "DateUI";

            var sortString = gridColumn.Property == "DateUI"
                ? "Date"
                : gridColumn.Property;

            var propertyName = $"{gridColumn.Type}{gridColumn.Property}";
            <RadzenDataGridColumn TItem="IDictionary<string, object>" Property="@this.GetColumnPropertyExpression(propertyName, typeof(string))" Title="@(gridColumn.Title)" FormatString="@(gridColumn.FormatString)" Sortable=@isSortable SortProperty="@sortString">
                <Template>
                    @if(context.TryGetValue(propertyName, out object value))
                    {
                        if (!string.IsNullOrEmpty(gridColumn.FormatString))
                        {
                            @string.Format(gridColumn.FormatString, value)
                        }
                        else
                        {
                            @value
                        }
                    }
                    
                </Template>
            </RadzenDataGridColumn>
        }             
    </Columns>
</RadzenDataGrid> 