@using System.Linq.Dynamic.Core
@using JXNippon.CentralizedDatabaseSystem.Domain.Interfaces
@using JXNippon.CentralizedDatabaseSystem.Models
@using System.Collections.Concurrent

<RadzenChart @ref="chart">
    @if (items != null)
    {   bool haveData = false;    
        string[] colors = this.Colors.ToArray();
        int i = -1;

        foreach (var series in ChartSeries.OrderBy(x => x.Sequence))
        {
            var type = series.ActualType ?? TType;
            IEnumerable<IDaily> dailyItems = null;
            if (items is not null && items.TryGetValue(type.AssemblyQualifiedName, out dailyItems))
            {
            }
            var seriesList = this.GetSeries(series, dailyItems);

            foreach (var group in seriesList)
            {
                var seriesItem = group.SeriesItems;
                i++;
                if (i >= colors.Count())
                {
                    i = 0;
                }
                switch (series.ChartType)
                {
                    case JXNippon.CentralizedDatabaseSystem.Domain.Charts.ChartType.AreaChart:
                    {
                        string color = string.IsNullOrEmpty(series.Color)
                            ? colors[i]
                            : series.Color;

                        <RadzenAreaSeries Data="@seriesItem" CategoryProperty="Category"
                            Title="@group.Title" ValueProperty="Value"
                            LineType="@((LineType)Enum.Parse(typeof(LineType), series.LineType))"
                            Stroke=@color
                            Fill=@color
                            Smooth="@series.Smooth">
                            <RadzenMarkers MarkerType="@((MarkerType)Enum.Parse(typeof(MarkerType), series.MarkerType))" />
                        </RadzenAreaSeries>
                        break;
                    }
                    case JXNippon.CentralizedDatabaseSystem.Domain.Charts.ChartType.LineChart:
                    {              
                        string color = string.IsNullOrEmpty(series.Color)
                            ? colors[i]
                            : series.Color;
                        <RadzenLineSeries Data="@seriesItem" CategoryProperty="Category"
                            Title="@group.Title" ValueProperty="Value"
                            Stroke=@color
                            LineType="@((LineType)Enum.Parse(typeof(LineType), series.LineType))"
                            Smooth="@series.Smooth" 
                            >
                        <RadzenMarkers MarkerType="@((MarkerType)Enum.Parse(typeof(MarkerType), series.MarkerType))" />
                        </RadzenLineSeries>
                        break;
                    };
                    case JXNippon.CentralizedDatabaseSystem.Domain.Charts.ChartType.BarChart:
                    {                           
                        <RadzenBarSeries Data="@seriesItem" CategoryProperty="Category"
                            Title="@group.Title" ValueProperty="Value"
                            Fills=@colors
                            LineType="@((LineType)Enum.Parse(typeof(LineType), series.LineType))">
                            <RadzenMarkers MarkerType="@((MarkerType)Enum.Parse(typeof(MarkerType), series.MarkerType))" />
                        </RadzenBarSeries>
                        break;
                    };
                    case JXNippon.CentralizedDatabaseSystem.Domain.Charts.ChartType.ColumnChart:
                    {                           
                        <RadzenColumnSeries Data="@seriesItem" CategoryProperty="Category" 
                            Title="@group.Title" ValueProperty="Value" 
                            Fills=@colors
                            LineType="@((LineType)Enum.Parse(typeof(LineType), series.LineType))">
                            <RadzenMarkers MarkerType="@((MarkerType)Enum.Parse(typeof(MarkerType), series.MarkerType))" />
                        </RadzenColumnSeries>
                        break;
                    };
                    case JXNippon.CentralizedDatabaseSystem.Domain.Charts.ChartType.DonutChart:
                    {                           
                        <RadzenDonutSeries Data="@seriesItem" CategoryProperty="Category"
                            Title="@group.Title" ValueProperty="Value">
                            <RadzenMarkers MarkerType="@((MarkerType)Enum.Parse(typeof(MarkerType), series.MarkerType))" />
                        </RadzenDonutSeries>
                        break;
                    };
                    case JXNippon.CentralizedDatabaseSystem.Domain.Charts.ChartType.PieChart:
                    {                           
                        <RadzenPieSeries Data="@seriesItem" CategoryProperty="Category"
                            Title="@group.Title" ValueProperty="Value"
                            Fills=@colors>
                            <RadzenMarkers MarkerType="@((MarkerType)Enum.Parse(typeof(MarkerType), series.MarkerType))" />
                            </RadzenPieSeries>
                            break;
                        };
                    default:
                        {
                            break;       
                        }

                }


            }
            haveData = haveData || seriesList.Count() > 0;

        }
        if (!haveData)
        {
            <Empty/> 
        }

    }
    else
    {
        <Empty/>  
    }

    <RadzenCategoryAxis FormatString="@FormatString" Step="@Step" Visible="@(items?.Count() < 10)"/>
    <RadzenValueAxis Step="@ValueAxisStep">
        <RadzenGridLines/>
        <RadzenAxisTitle Text="@AxisTitle"/>
    </RadzenValueAxis>
    <RadzenLegend Position=LegendPosition.Bottom></RadzenLegend>
</RadzenChart>
