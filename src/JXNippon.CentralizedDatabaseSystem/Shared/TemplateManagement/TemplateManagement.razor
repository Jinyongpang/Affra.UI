@using AntDesign;
@using JXNippon.CentralizedDatabaseSystem.Domain.Views
@using JXNippon.CentralizedDatabaseSystem.Shared.OIMSummary
@inject IViewService ViewService

<Layout Class="layout-view" Style="height: 80vh;">
    <Sider Width=400>
        <Layout Style="height: 100%;">
            <Header>Table</Header>
            <Content style="overflow: auto; max-height: 100%;">
                <Menu @ref=menu Mode="MenuMode.Inline" OnMenuItemClicked=OnSelectAsync>
                    @{
                        var types = ViewService.GetTypeMapping()
                                    .Select(x => x.Key)
                                    .ToHashSet();
                        foreach (var type in types)
                        {
                            <MenuItem Key=@type>@type</MenuItem>
                        }
                    }
                </Menu>             
            </Content>
        </Layout>
    </Sider>
    <Layout Style="height:100%;">
        <Header Style="border-left: 1px solid #dbe0ea">
            <div>
                <span>Custom columns</span>    
                <Button Class="float-right align-items-center" Type="primary" Icon="@IconType.Outline.PlusCircle" Size="@("large")" Shape="@ButtonShape.Round" >Add</Button>
            </div>
        </Header>
        <Content Style="height:100%;">
            <TemplateManagementGrid @ref=templateManagementGrid PagerAlwaysVisible/>
        </Content>
    </Layout>
</Layout>

@code {

    ITable table;
    Menu menu;
    TemplateManagementGrid templateManagementGrid;
    string tableName { get { return menu?.SelectedKeys?.FirstOrDefault() ?? null; } }

    class Column
    {
        public string Name { get; set; }

        public int Age { get; set; }

        public string Address { get; set; }
    }

    Column[] data =
    {
        new Column()
        {
            Name = "John Brown",
            Age = 32,
            Address = "New York No. 1 Lake Park",
        },
        new Column()
        {
            Name = "Jim Green",
            Age = 42,
            Address = "London No. 1 Lake Park",
        },
        new Column()
        {
            Name = "Joe Black",
            Age = 32,
            Address = "Sidney No. 1 Lake Park",
        },
        new Column()
        {
            Name = "Disabled User",
            Age = 99,
            Address = "Sidney No. 1 Lake Park",
        }
    };

    IEnumerable<Column> selectedRows;
    string selectionType = "checkbox";

    public void RemoveSelection(string key)
    {
        var selected = selectedRows.Where(x => x.Name != key).ToList();
        table.SetSelection(selected.Select(x => x.Name).ToArray());
    }

    private Task OnSelectAsync(MenuItem menuItem)
    {
        templateManagementGrid.TableName = menuItem.Key;
        return templateManagementGrid.ReloadAsync();
    }
}